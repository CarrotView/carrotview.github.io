<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Automate product marketing — CarrotView</title>
  <meta name="description" content="Automate product marketing with a launch-ready content kit built from your product footage." />

  <style>
    :root{
      --bg: #070A12;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.09);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --border: rgba(255,255,255,.12);
      --shadow: 0 22px 70px rgba(0,0,0,.55);
      --shadow2: 0 12px 40px rgba(0,0,0,.35);
      --radius: 22px;
      --radius2: 16px;
      --max: 1120px;
    }

    *{ box-sizing:border-box; }
    html, body { height: 100%; max-width: 100%; overflow-x: hidden; scroll-behavior:smooth; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color: var(--text);
      background:
        radial-gradient(900px 520px at 60% -10%, rgba(130,95,255,.22), transparent 60%),
        radial-gradient(900px 520px at 20% 10%, rgba(0,225,255,.14), transparent 60%),
        radial-gradient(900px 520px at 80% 60%, rgba(255,95,170,.12), transparent 60%),
        var(--bg);
    }
    a{ color:inherit; text-decoration:none; }
    .container{ width: min(var(--max), 92vw); margin: 0 auto; }

    header{
      position: sticky; top: 0; z-index: 20;
      backdrop-filter: blur(14px);
      background: linear-gradient(to bottom, rgba(7,10,18,.78), rgba(7,10,18,.30));
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .nav{
      display:flex; align-items:center; justify-content:space-between;
      padding: 16px 0; gap: 12px;
    }
    .brand{ display:flex; align-items:center; gap: 10px; font-weight: 900; letter-spacing: .2px; }
    .logo{
      width: 34px; height: 34px; border-radius: 10px;
      background: conic-gradient(from 180deg, rgba(130,95,255,1), rgba(0,225,255,1), rgba(255,95,170,1), rgba(130,95,255,1));
      box-shadow: 0 10px 30px rgba(130,95,255,.18);
      flex: 0 0 auto;
    }

    .nav-links{
      display:none; gap: 18px; align-items:center;
      list-style:none; margin:0; padding:0;
      color: var(--muted); font-weight: 800; font-size: 14px;
    }
    @media (min-width: 880px){ .nav-links{ display:flex; } }

    .nav-cta{ display:flex; align-items:center; gap: 10px; }

    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      height: 42px; padding: 0 14px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--text);
      font-weight: 900; font-size: 14px;
      transition: transform .15s ease, background .15s ease, border-color .15s ease, filter .15s ease;
      white-space: nowrap;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.18); }
    .btn:disabled{ opacity:.55; cursor:not-allowed; transform:none; }
    .btn.primary{
      border: none;
      background: linear-gradient(135deg, rgba(130,95,255,1), rgba(0,225,255,1));
      color: rgba(7,10,18,.95);
      box-shadow: 0 16px 40px rgba(0,225,255,.14), 0 14px 36px rgba(130,95,255,.14);
    }
    .btn.primary:hover{ filter: brightness(1.06); }

    .dropdown { position: relative; }
    .dropbtn{
      background: transparent;
      border: none;
      color: inherit;
      font: inherit;
      padding: 8px 10px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 900;
      font-size: 14px;
      color: var(--muted);
      display:inline-flex;
      align-items:center;
      gap: 8px;
    }
    .dropbtn:hover{ color: var(--text); background: rgba(255,255,255,.04); }
    .caret{
      width: 10px; height: 10px;
      display:inline-block;
      border-right: 2px solid rgba(255,255,255,.55);
      border-bottom: 2px solid rgba(255,255,255,.55);
      transform: rotate(45deg);
      margin-top: -2px;
    }

    .menu{
      position:absolute;
      top: 44px;
      left: 0;
      min-width: 240px;
      padding: 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(10,14,26,.92);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      display:none;
    }
    .menu a{
      display:block;
      padding: 10px 10px;
      border-radius: 12px;
      font-weight: 800;
      color: rgba(255,255,255,.80);
      font-size: 13.5px;
    }
    .menu a:hover{ background: rgba(255,255,255,.06); color: var(--text); }
    .menu small{
      display:block;
      margin: 2px 10px 10px;
      color: rgba(255,255,255,.55);
      font-weight: 700;
    }
    .dropdown.open .menu{ display:block; }

    .hero{ padding: 64px 0 24px; }
    .hero-grid{
      display:grid; grid-template-columns: 1fr;
      gap: 26px; align-items:center;
    }
    @media (min-width: 980px){ .hero-grid{ grid-template-columns: 1.1fr .9fr; gap: 36px; } }

    .pill{
      display:inline-flex; align-items:center; gap: 10px;
      padding: 8px 12px; border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      font-weight: 900; font-size: 13px;
    }
    .pill b{ color: var(--text); }

    h1{
      margin: 14px 0 12px;
      font-size: clamp(34px, 4.2vw, 56px);
      line-height: 1.04;
      letter-spacing: -0.9px;
    }
    .sub{
      margin: 0 0 18px;
      color: var(--muted);
      font-size: 16.5px;
      line-height: 1.6;
      max-width: 60ch;
    }
    .cta-row{ display:flex; gap: 12px; flex-wrap:wrap; align-items:center; margin-top: 4px; }
    .input-wrap{
      display:flex; align-items:center; gap: 10px; flex-wrap:wrap;
      width: min(560px, 100%);
      padding: 10px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      box-shadow: var(--shadow2);
    }
    .url-input{
      flex: 1 1 260px;
      min-width: 220px;
      height: 44px;
      padding: 0 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(7,10,18,.55);
      color: var(--text);
      font-weight: 700;
      font-size: 14px;
      outline: none;
    }
    .url-input::placeholder{ color: rgba(255,255,255,.46); }
    .url-input:focus{
      border-color: rgba(0,225,255,.6);
      box-shadow: 0 0 0 3px rgba(0,225,255,.15);
    }
    .input-hint{
      width: 100%;
      color: rgba(255,255,255,.55);
      font-weight: 700;
      font-size: 12px;
      margin-top: 4px;
    }
    .input-actions{
      display:flex;
      gap: 10px;
      align-items:center;
      width: 100%;
    }
    .url-preview{
      font-size: 12.5px;
      color: rgba(255,255,255,.7);
      font-weight: 800;
    }
    .url-preview span{ color: rgba(0,225,255,.95); }
    .btn.generate{
      height: 40px;
      padding: 0 12px;
      border-radius: 12px;
    }
    .status{
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      font-weight: 800;
      font-size: 13px;
      color: rgba(255,255,255,.72);
      display:none;
    }
    .status.show{ display:block; }
    .status.error{ border-color: rgba(255,95,170,.4); color: rgba(255,255,255,.9); }

    .video-grid{
      margin-top: 18px;
      display:grid;
      gap: 16px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 900px){ .video-grid{ grid-template-columns: repeat(2, 1fr); } }

    .video-card{
      border-radius: var(--radius2);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      padding: 12px;
      box-shadow: var(--shadow2);
    }
    .video-card h4{ margin: 0 0 8px; font-size: 14px; }
    .video-card video{ width: 100%; border-radius: 12px; background: #000; }
    .image-card{
      margin-top: 18px;
      border-radius: var(--radius2);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      padding: 12px;
      box-shadow: var(--shadow2);
    }
    .image-card h4{ margin: 0 0 10px; font-size: 14px; }
    .image-card img{ width: 100%; border-radius: 12px; display:block; }
    .prompt-editor{
      margin-top: 14px;
      border-radius: var(--radius2);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      padding: 14px;
      display:none;
    }
    .prompt-editor.show{ display:block; }
    .prompt-editor h4{
      margin: 0 0 10px;
      font-size: 14px;
      color: rgba(255,255,255,.9);
    }
    .prompt-grid{
      display: grid;
      gap: 10px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 900px){
      .prompt-grid{ grid-template-columns: 1fr 1fr; }
    }
    .field{
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .field label{
      font-size: 12px;
      font-weight: 800;
      color: rgba(255,255,255,.72);
      letter-spacing: .2px;
      text-transform: uppercase;
    }
    .prompt-editor textarea{
      width: 100%;
      min-height: 90px;
      resize: vertical;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(7,10,18,.45);
      color: var(--text);
      padding: 12px;
      font: inherit;
      line-height: 1.45;
      margin-bottom: 10px;
      outline: none;
    }
    .prompt-editor textarea:focus{
      border-color: rgba(0,225,255,.6);
      box-shadow: 0 0 0 3px rgba(0,225,255,.15);
    }
    .platform-row{
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .platform-label{
      font-size: 12px;
      font-weight: 800;
      color: rgba(255,255,255,.72);
      letter-spacing: .2px;
      text-transform: uppercase;
    }
    .platform-picker{
      display:flex;
      gap: 8px;
    }
    .platform-btn{
      width: 42px;
      height: 42px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.05);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      color: rgba(255,255,255,.78);
    }
    .platform-btn svg{ width: 20px; height: 20px; }
    .platform-btn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.35); }
    .platform-btn.active{
      border-color: rgba(0,225,255,.8);
      background: rgba(0,225,255,.16);
      color: rgba(255,255,255,.96);
      box-shadow: 0 0 0 2px rgba(0,225,255,.2);
    }
    .editor-actions{
      margin-top: 10px;
      display:flex;
      justify-content:space-between;
      gap: 10px;
      flex-wrap: wrap;
    }
    .style-row{
      margin-top: 10px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .section-label{
      margin-top: 12px;
      margin-bottom: 8px;
      font-size: 12px;
      font-weight: 800;
      color: rgba(255,255,255,.72);
      letter-spacing: .2px;
      text-transform: uppercase;
    }
    @media (min-width: 900px){
      .style-row{ grid-template-columns: 1fr 1fr 1fr; }
    }
    .style-select{
      width: 100%;
      height: 42px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(7,10,18,.45);
      color: var(--text);
      padding: 0 10px;
      font: inherit;
      outline: none;
    }
    .style-select:focus{
      border-color: rgba(0,225,255,.6);
      box-shadow: 0 0 0 3px rgba(0,225,255,.15);
    }

    .hero-card{
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(to bottom right, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      overflow: hidden;
      padding: 22px;
    }
    .hero-card h3{ margin: 0 0 10px; font-size: 18px; }
    .hero-card ul{ margin: 0; padding-left: 18px; color: rgba(255,255,255,.72); line-height: 1.6; }

    .section{ padding: 56px 0; }
    .section h2{ font-size: clamp(26px, 3.2vw, 36px); margin: 0 0 10px; }
    .section p{ color: var(--muted); line-height: 1.6; max-width: 70ch; }

    .grid-3{
      display:grid; gap: 18px; margin-top: 18px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 900px){ .grid-3{ grid-template-columns: repeat(3, 1fr); } }

    .card{
      border-radius: var(--radius2);
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      padding: 18px;
      box-shadow: var(--shadow2);
    }
    .card h4{ margin: 0 0 8px; }
    .card p{ margin: 0; color: var(--muted); line-height: 1.6; }

    footer{
      padding: 36px 0 40px;
      color: rgba(255,255,255,.58);
      font-weight: 800;
      font-size: 13px;
      border-top: 1px solid rgba(255,255,255,.06);
      margin-top: 26px;
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="nav">
        <a class="brand" href="/">
          <span class="logo" aria-hidden="true"></span>
          <span>CarrotView</span>
        </a>

        <ul class="nav-links">
          <li class="dropdown">
            <button class="dropbtn" type="button" aria-haspopup="true" aria-expanded="false">
              Features <span class="caret" aria-hidden="true"></span>
            </button>
            <div class="menu" role="menu" aria-label="Features menu">
              <small>Explore</small>
              <a href="/#features-detection" role="menuitem">Viral moment detection</a>
              <a href="/#features-formatting" role="menuitem">Shorts-first formatting</a>
              <a href="/#features-captions" role="menuitem">Hooks + captions</a>
              <a href="/features/product_marketing" role="menuitem">Product marketing</a>
            </div>
          </li>

          <li><a href="/#how">How it works</a></li>
        </ul>

        <div class="nav-cta">
          <a class="btn primary" href="/#get-started">Get started</a>
        </div>
      </div>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="container">
        <div class="hero-grid">
          <div>
            <div class="pill"><b>New</b> • Product Marketing</div>
            <h1>Automate product marketing.</h1>
            <p class="sub">
              Focus on building your product while we get you the visibility on social media.
            </p>

            <div class="cta-row">
              <form class="input-wrap" id="search-form">
                <input
                  id="site-url"
                  class="url-input"
                  type="url"
                  name="site-url"
                  placeholder="Paste your website URL"
                  autocomplete="url"
                  spellcheck="false"
                />
                <div class="input-actions">
                  <span class="url-preview" id="url-preview">Preview: <span>—</span></span>
                  <button class="btn primary generate" id="generate-btn" type="submit">Generate Prompt</button>
                </div>
                <span class="input-hint">We will use your site to tailor clips and positioning.</span>
              </form>
            </div>
            <div class="status" id="job-status" aria-live="polite"></div>
            <div class="prompt-editor" id="prompt-editor">
              <h4>Review and edit your video brief</h4>
              <div class="platform-row">
                <span class="platform-label">Publishing platform</span>
                <div class="platform-picker" id="platform-picker">
                  <button class="platform-btn active" data-platform="linkedin" title="LinkedIn" aria-label="LinkedIn" type="button">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <rect x="2" y="2" width="20" height="20" rx="4" fill="currentColor"></rect>
                      <rect x="6.2" y="10" width="2.2" height="7.8" fill="#070A12"></rect>
                      <circle cx="7.3" cy="7.4" r="1.2" fill="#070A12"></circle>
                      <path d="M10.5 10h2.1v1.1c.4-.7 1.3-1.3 2.6-1.3 2.4 0 3.2 1.5 3.2 3.9v4.1h-2.3v-3.7c0-1.2-.2-2.1-1.4-2.1-1.2 0-1.8.8-1.8 2v3.8h-2.3V10z" fill="#070A12"></path>
                    </svg>
                  </button>
                  <button class="platform-btn" data-platform="youtube_shorts" title="YouTube Shorts" aria-label="YouTube Shorts" type="button">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <rect x="3" y="5" width="18" height="14" rx="4" fill="#FF0033"></rect>
                      <polygon points="11,9 16,12 11,15" fill="#fff"></polygon>
                    </svg>
                  </button>
                  <button class="platform-btn" data-platform="tiktok" title="TikTok" aria-label="TikTok" type="button">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <rect x="2" y="2" width="20" height="20" rx="4" fill="#121212"></rect>
                      <path d="M14.5 7.2c.7.9 1.6 1.4 2.7 1.5v2c-1-.1-2-.4-2.9-1v4.8c0 2-1.5 3.5-3.6 3.5s-3.6-1.5-3.6-3.5 1.5-3.5 3.6-3.5c.2 0 .4 0 .6.1v2.1a1.6 1.6 0 00-.6-.1c-.8 0-1.5.6-1.5 1.5s.7 1.5 1.5 1.5 1.5-.6 1.5-1.5V6h2.3v1.2z" fill="#fff"></path>
                    </svg>
                  </button>
                </div>
              </div>
              <div class="prompt-grid">
                <div class="field">
                  <label for="prompt-hook">Hook</label>
                  <textarea id="prompt-hook" placeholder="Open with a sharp attention-grabbing line..."></textarea>
                </div>
                <div class="field">
                  <label for="prompt-problem">Problem</label>
                  <textarea id="prompt-problem" placeholder="Describe the core pain point for the audience..."></textarea>
                </div>
                <div class="field">
                  <label for="prompt-solution">Solution</label>
                  <textarea id="prompt-solution" placeholder="Position the product as the clear solution..."></textarea>
                </div>
                <div class="field">
                  <label for="prompt-cta">Call To Action</label>
                  <textarea id="prompt-cta" placeholder="Give a clear action for the viewer..."></textarea>
                </div>
              </div>
              <div class="section-label">Audience Targeting</div>
              <div class="style-row">
                <div class="field">
                  <label for="audience-region">Geography</label>
                  <select id="audience-region" class="style-select">
                    <option value="United States and Canada">United States + Canada</option>
                    <option value="North America">North America</option>
                    <option value="United Kingdom and Europe">UK + Europe</option>
                    <option value="India and Southeast Asia">India + Southeast Asia</option>
                    <option value="Global English-speaking markets">Global English-speaking Markets</option>
                  </select>
                </div>
                <div class="field">
                  <label for="audience-job-title">Job Function / Title</label>
                  <select id="audience-job-title" class="style-select">
                    <option value="Product Marketing Managers and Growth Marketers">Product Marketing + Growth</option>
                    <option value="CMOs, VPs, and Heads of Marketing">Marketing Leadership (CMO/VP/Head)</option>
                    <option value="Demand Generation Managers">Demand Generation</option>
                    <option value="Founders and GTM Leaders">Founders + GTM Leaders</option>
                    <option value="RevOps and Performance Marketing Teams">RevOps + Performance</option>
                  </select>
                </div>
                <div class="field">
                  <label for="audience-company-category">Company Category</label>
                  <select id="audience-company-category" class="style-select">
                    <option value="B2B SaaS companies">B2B SaaS</option>
                    <option value="Fintech and Financial Services">Fintech + Financial Services</option>
                    <option value="Ecommerce and Retail Tech">Ecommerce + Retail Tech</option>
                    <option value="Agencies and Marketing Services">Agencies + Marketing Services</option>
                    <option value="Enterprise Software companies">Enterprise Software</option>
                  </select>
                </div>
              </div>
              <div class="section-label">Visual Direction</div>
              <div class="style-row">
                <div class="field">
                  <label for="style-visual">Visual Style</label>
                  <select id="style-visual" class="style-select">
                    <option value="clean product UI, premium b2b look">Clean Product UI</option>
                    <option value="cinematic launch vibe with dramatic lighting">Cinematic Launch</option>
                    <option value="data-driven modern ad with overlays">Data-Driven Ad</option>
                  </select>
                </div>
                <div class="field">
                  <label for="style-pacing">Pacing</label>
                  <select id="style-pacing" class="style-select">
                    <option value="fast with decisive cuts">Fast</option>
                    <option value="medium with balanced rhythm">Medium</option>
                    <option value="high-energy with aggressive pacing">High Energy</option>
                  </select>
                </div>
                <div class="field">
                  <label for="style-technique">Camera Technique</label>
                  <select id="style-technique" class="style-select">
                    <option value="quick push-ins and smart close-ups">Push-ins + Close-ups</option>
                    <option value="dynamic parallax and punch-in zooms">Parallax + Punch Zoom</option>
                    <option value="steady product hero shots with kinetic overlays">Hero Shots + Kinetic Text</option>
                  </select>
                </div>
                <div class="field">
                  <label for="style-image-technique">Image Technique</label>
                  <select id="style-image-technique" class="style-select">
                    <option value="vector illustration">Vector Illustration</option>
                    <option value="flat geometric brand illustration">Flat Geometric</option>
                    <option value="3d product render style">3D Render Style</option>
                    <option value="isometric product scene">Isometric Scene</option>
                  </select>
                </div>
              </div>
              <div class="editor-actions">
                <button class="btn" id="download-json-btn" type="button">Download JSON</button>
                <button class="btn" id="generate-video-btn" type="button" disabled>Campaign Video</button>
                <button class="btn primary" id="generate-image-btn" type="button">Generate ad campaign image</button>
              </div>
            </div>
            <div class="video-grid" id="video-results"></div>
          </div>

          <div class="hero-card" aria-label="Product marketing kit overview">
            <h3>What you get</h3>
            <ul>
              <li>5–12 launch clips sized for Shorts, Reels, and TikTok</li>
              <li>Feature-by-feature highlight reels</li>
              <li>Problem/solution hooks tailored to your ICP</li>
              <li>Draft captions and CTA suggestions</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <section class="section" id="kit">
      <div class="container">
        <h2>The Product Marketing Launch Kit</h2>
        <p>
          Drop in long-form demos, webinar recordings, or customer interviews. CarrotView finds the most
          persuasive moments, packages them by feature, and delivers a structured content kit your team can ship fast.
        </p>

        <div class="grid-3">
          <div class="card">
            <h4>Segment by persona</h4>
            <p>Generate variants for founders, marketers, and operators with tone and proof points tuned per audience.</p>
          </div>
          <div class="card">
            <h4>Channel-ready formats</h4>
            <p>Export 9:16 and 1:1 clips with safe framing, hooks, and captions for social-first performance.</p>
          </div>
          <div class="card">
            <h4>Launch calendar included</h4>
            <p>Arrange the kit into a 2–3 week rollout with sequencing guidance for awareness to conversion.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="container">
        <h2>From demo to demand in one workflow</h2>
        <p>
          CarrotView builds a narrative arc across clips, so your launch content feels connected instead of fragmented.
          Keep your product story consistent while accelerating production.
        </p>
      </div>
    </section>

    <footer>
      <div class="container">
        <div style="display:flex; justify-content:space-between; gap:14px; flex-wrap:wrap;">
          <span>© <span id="year"></span> CarrotView</span>
          <span style="color: rgba(255,255,255,.52)">Product Marketing • Launch-ready content kit</span>
        </div>
      </div>
    </footer>
  </main>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    (function () {
      const dd = document.querySelector(".dropdown");
      if (!dd) return;

      const btn = dd.querySelector(".dropbtn");

      function close() {
        dd.classList.remove("open");
        btn.setAttribute("aria-expanded", "false");
      }

      function toggle() {
        const open = dd.classList.toggle("open");
        btn.setAttribute("aria-expanded", open ? "true" : "false");
      }

      btn.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        toggle();
      });

      document.addEventListener("click", () => close());
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") close();
      });
    })();

    (function () {
      const form = document.getElementById("search-form");
      const input = document.getElementById("site-url");
      const previewEl = document.getElementById("url-preview");
      const generateBtn = document.getElementById("generate-btn");
      const generateVideoBtn = document.getElementById("generate-video-btn");
      const generateImageBtn = document.getElementById("generate-image-btn");
      const downloadJsonBtn = document.getElementById("download-json-btn");
      const promptEditor = document.getElementById("prompt-editor");
      const platformPicker = document.getElementById("platform-picker");
      const promptHook = document.getElementById("prompt-hook");
      const promptProblem = document.getElementById("prompt-problem");
      const promptSolution = document.getElementById("prompt-solution");
      const promptCta = document.getElementById("prompt-cta");
      const audienceRegion = document.getElementById("audience-region");
      const audienceJobTitle = document.getElementById("audience-job-title");
      const audienceCompanyCategory = document.getElementById("audience-company-category");
      const styleVisual = document.getElementById("style-visual");
      const stylePacing = document.getElementById("style-pacing");
      const styleTechnique = document.getElementById("style-technique");
      const styleImageTechnique = document.getElementById("style-image-technique");
      const statusEl = document.getElementById("job-status");
      const resultsEl = document.getElementById("video-results");

      const API_BASE = window.CARROTVIEW_API_BASE || "http://localhost:8787";
      let activeJobId = null;
      let lastSubmittedUrl = "";
      let pollTimer = null;
      let isPromptLoading = false;
      let isImageLoading = false;
      let selectedPlatform = "linkedin";

      function setStatus(message, { error = false, show = true } = {}) {
        statusEl.textContent = message;
        statusEl.classList.toggle("show", show);
        statusEl.classList.toggle("error", error);
      }

      function clearResults() {
        resultsEl.innerHTML = "";
      }

      function showPromptEditor(show) {
        promptEditor.classList.toggle("show", show);
      }

      function setPromptLoading(next) {
        isPromptLoading = next;
        input.disabled = next;
        generateBtn.disabled = next;
        generateBtn.textContent = next ? "Generating Prompt..." : "Generate Prompt";
      }

      function setImageLoading(next) {
        isImageLoading = next;
        promptHook.disabled = next;
        promptProblem.disabled = next;
        promptSolution.disabled = next;
        promptCta.disabled = next;
        audienceRegion.disabled = next;
        audienceJobTitle.disabled = next;
        audienceCompanyCategory.disabled = next;
        styleVisual.disabled = next;
        stylePacing.disabled = next;
        styleTechnique.disabled = next;
        styleImageTechnique.disabled = next;
        platformPicker.querySelectorAll(".platform-btn").forEach((btn) => {
          btn.disabled = next;
        });
        downloadJsonBtn.disabled = next;
        generateImageBtn.disabled = next;
        generateImageBtn.textContent = next ? "Generating Ad Image..." : "Generate ad campaign image";
      }

      function fillPromptFieldsFromPlan(plan) {
        if (!plan || typeof plan !== "object") return false;
        const framework = plan.message_framework || {};
        const styles = plan.style_controls || {};
        const targeting = plan.audience_targeting || {};
        promptHook.value = framework.hook || "";
        promptProblem.value = framework.problem || "";
        promptSolution.value = framework.solution || "";
        promptCta.value = framework.cta || "";
        if (targeting.regions) audienceRegion.value = Array.isArray(targeting.regions) ? targeting.regions[0] : targeting.regions;
        if (targeting.job_titles) audienceJobTitle.value = Array.isArray(targeting.job_titles) ? targeting.job_titles[0] : targeting.job_titles;
        if (targeting.company_category) audienceCompanyCategory.value = targeting.company_category;
        if (targeting.industries && !targeting.company_category) {
          audienceCompanyCategory.value = Array.isArray(targeting.industries) ? targeting.industries[0] : targeting.industries;
        }
        if (styles.visual_style) styleVisual.value = styles.visual_style;
        if (styles.pacing) stylePacing.value = styles.pacing;
        if (styles.camera_technique) styleTechnique.value = styles.camera_technique;
        if (styles.image_technique) styleImageTechnique.value = styles.image_technique;
        return Boolean(promptHook.value || promptProblem.value || promptSolution.value);
      }

      function fillPromptFieldsFromText(source) {
        const text = (source || "").trim();
        if (!text) return;

        const lines = text.split(/\n+/).map((line) => line.trim()).filter(Boolean);
        const hookLine = lines.find((line) => /^hook[:\-]/i.test(line));
        const problemLine = lines.find((line) => /^problem[:\-]/i.test(line));
        const solutionLine = lines.find((line) => /^solution[:\-]/i.test(line));
        const ctaLine = lines.find((line) => /^cta[:\-]|^call to action[:\-]/i.test(line));

        promptHook.value = hookLine ? hookLine.replace(/^hook[:\-]\s*/i, "") : (lines[0] || "");
        promptProblem.value = problemLine ? problemLine.replace(/^problem[:\-]\s*/i, "") : (lines[1] || "");
        promptSolution.value = solutionLine ? solutionLine.replace(/^solution[:\-]\s*/i, "") : text;
        promptCta.value = ctaLine ? ctaLine.replace(/^(cta|call to action)[:\-]\s*/i, "") : "";
      }

      function getPromptPayload() {
        return {
          platform: selectedPlatform,
          audience_targeting: {
            geography: audienceRegion.value,
            job_title: audienceJobTitle.value,
            company_category: audienceCompanyCategory.value
          },
          message_framework: {
            hook: promptHook.value.trim(),
            problem: promptProblem.value.trim(),
            solution: promptSolution.value.trim(),
            cta: promptCta.value.trim()
          },
          style_controls: {
            visual_style: styleVisual.value,
            pacing: stylePacing.value,
            camera_technique: styleTechnique.value,
            image_technique: styleImageTechnique.value
          }
        };
      }

      function downloadPromptJson() {
        const payload = getPromptPayload();
        const blob = new Blob([JSON.stringify(payload, null, 2)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `carrotview_prompt_${activeJobId || "draft"}.json`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      }

      function normalizeUrl(raw) {
        let value = raw.trim();
        if (!value) return { ok: false, value: "", error: "Please paste a URL." };
        if (!value.includes("://")) value = `https://${value}`;
        try {
          const url = new URL(value);
          if (url.protocol !== "http:" && url.protocol !== "https:") {
            return { ok: false, value, error: "URL must start with http or https." };
          }
          if (!url.hostname.includes(".")) {
            return { ok: false, value, error: "Enter a valid website domain." };
          }
          return { ok: true, value: url.toString(), error: "" };
        } catch {
          return { ok: false, value, error: "Enter a valid website URL." };
        }
      }

      function updatePreview(raw) {
        const normalized = normalizeUrl(raw);
        if (!normalized.ok) {
          previewEl.innerHTML = "Preview: <span>—</span>";
          return;
        }
        previewEl.innerHTML = `Preview: <span>${normalized.value}</span>`;
      }

      function renderVideos(videoAUrl, videoBUrl) {
        if (!videoAUrl || !videoBUrl) return;
        resultsEl.innerHTML = `
          <div class="video-card">
            <h4>Video A</h4>
            <video controls playsinline src="${videoAUrl}"></video>
          </div>
          <div class="video-card">
            <h4>Video B</h4>
            <video controls playsinline src="${videoBUrl}"></video>
          </div>
        `;
      }

      function renderImage(imageUrl) {
        if (!imageUrl) return;
        resultsEl.innerHTML = `
          <div class="image-card">
            <h4>Campaign Image</h4>
            <img src="${imageUrl}" alt="Generated campaign image" />
          </div>
        `;
      }

      async function pollStatus(jobId) {
        try {
          const res = await fetch(`${API_BASE}/api/product-marketing/status?jobId=${jobId}`);
          const data = await res.json();
          if (!res.ok) {
            setStatus(data.error || "Unable to fetch job status.", { error: true });
            return;
          }

          if (data.status === "completed") {
            if (data.imageUrl) {
              setStatus("Your campaign image is ready.");
              renderImage(data.imageUrl);
            } else {
              setStatus("Completed.");
              renderVideos(data.videoAUrl, data.videoBUrl);
            }
            setImageLoading(false);
            setPromptLoading(false);
            clearInterval(pollTimer);
            pollTimer = null;
            return;
          }

          if (data.status === "prompt_ready") {
            setStatus("Prompt generated. Review it and click Generate ad campaign image.");
            const loadedFromPlan = fillPromptFieldsFromPlan(data.generatedPlan);
            if (!loadedFromPlan) fillPromptFieldsFromText(data.generatedPrompt || "");
            showPromptEditor(true);
            setPromptLoading(false);
            clearInterval(pollTimer);
            pollTimer = null;
            return;
          }

          if (data.status === "failed") {
            setStatus(data.error || "We hit a snag generating your campaign image.", { error: true });
            setImageLoading(false);
            setPromptLoading(false);
            clearInterval(pollTimer);
            pollTimer = null;
            return;
          }

          const progressText = data.progress ? ` • ${data.progress}` : "";
          setStatus(`Working on it${progressText}`);
        } catch (err) {
          setStatus("Network error. Please try again.", { error: true });
          setImageLoading(false);
          setPromptLoading(false);
          clearInterval(pollTimer);
          pollTimer = null;
        }
      }

      async function submitUrlForPrompt(url) {
        clearResults();
        showPromptEditor(false);
        setStatus("Starting your request...");
        setPromptLoading(true);
        lastSubmittedUrl = url;

        try {
          const res = await fetch(`${API_BASE}/api/product-marketing/generate-prompt`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ url })
          });

          const data = await res.json();
          if (!res.ok) {
            setStatus(data.error || "Unable to start. Check the URL.", { error: true });
            setPromptLoading(false);
            return;
          }

          activeJobId = data.jobId;
          setStatus("Queued. Reading your website...");

          if (pollTimer) clearInterval(pollTimer);
          pollTimer = setInterval(() => pollStatus(activeJobId), 5000);
          pollStatus(activeJobId);
        } catch (err) {
          setStatus("Network error. Please try again.", { error: true });
          setPromptLoading(false);
        }
      }

      async function submitPromptForImage() {
        if (!activeJobId) {
          setStatus("Generate a prompt first.", { error: true });
          return;
        }
        if (!promptHook.value.trim() || !promptProblem.value.trim() || !promptSolution.value.trim()) {
          setStatus("Please complete Hook, Problem, and Solution before generating image.", { error: true });
          return;
        }

        const promptPlan = getPromptPayload();
        setImageLoading(true);
        setStatus("Queued. Starting ad campaign image generation...");
        clearResults();

        try {
          const res = await fetch(`${API_BASE}/api/product-marketing/generate-image`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ jobId: activeJobId, promptPlan })
          });
          const data = await res.json();
          if (!res.ok) {
            setStatus(data.error || "Unable to start image generation.", { error: true });
            setImageLoading(false);
            return;
          }

          if (pollTimer) clearInterval(pollTimer);
          pollTimer = setInterval(() => pollStatus(activeJobId), 5000);
          pollStatus(activeJobId);
        } catch (err) {
          setStatus("Network error. Please try again.", { error: true });
          setImageLoading(false);
        }
      }

      input.addEventListener("input", (event) => {
        updatePreview(event.target.value);
      });

      function handleSubmit(event) {
        event.preventDefault();
        if (isPromptLoading || isImageLoading) return;

        const normalized = normalizeUrl(input.value);
        if (!normalized.ok) {
          setStatus(normalized.error, { error: true });
          return false;
        }

        // Keep URL parsing strict, matching the attached search-bar behavior.
        try {
          new URL(normalized.value);
        } catch (_err) {
          setStatus("Please enter a valid URL (e.g., https://example.com)", { error: true });
          return false;
        }

        if (normalized.value === lastSubmittedUrl) {
          if (!promptEditor.classList.contains("show")) {
            setStatus("This URL was already submitted.");
            return false;
          }
        }
        submitUrlForPrompt(normalized.value);
        return false;
      }

      form.addEventListener("submit", handleSubmit);
      platformPicker.addEventListener("click", (event) => {
        const btn = event.target.closest(".platform-btn");
        if (!btn) return;
        selectedPlatform = btn.dataset.platform || "linkedin";
        platformPicker.querySelectorAll(".platform-btn").forEach((node) => {
          node.classList.toggle("active", node === btn);
        });
      });
      generateVideoBtn.addEventListener("click", () => {
        setStatus("Campaign video workflow is currently disabled. Use Generate ad campaign image.", { error: true });
      });
      generateImageBtn.addEventListener("click", submitPromptForImage);
      downloadJsonBtn.addEventListener("click", downloadPromptJson);
    })();
  </script>
</body>
</html>
